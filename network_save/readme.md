# 项目文档

## 文件名
`windows` 和 `Linux` 表示服务器端和客户端所在的环境。

## 甲方需求
`接受数据源板通过网口（协议为UDP）发送的所有数据至存储板硬盘`    
    
### 具体描述
该数据存储板与数据源板、及其他设备或上位机均通过交换机连接于同一个本地网络中。
数据源板的传输协议为UDP，数据率最大不大于2MB/s，数据协议见附录4。因采用UDP传输，
收包顺序可能为乱序，不需要整理包的顺序，可后期读出由上位机软件进行数据包顺序的整理。
存储板配置1路SATA硬盘和1路千兆网。存储板通过千兆网接收来自数据源板的数据后，
立即保存至SATA硬盘中。待工作结束，可通过千兆网读出硬盘中的数据文件。

## 版本
`v5`

## 功能描述
v1:
在不同环境下，Windows 和 Linux 的服务器端可以进行简单的通信。然而，目前尚未实现保存的功能。

v2:
在v1的基础上，实现了在Windows和Linux环境下，服务器端可以接收来自客户端的数据，并将其保存到本地文件中。
具体的实现方式需要等到结合硬件才能修改

v3:
按照10hz的频率发送，每次tPing包含100个包，每个包大小为1044字节，但是在长时间工作下，出现了丢包问题

v4:
接收端在发送时，每一个包，都有0.5毫秒的暂停，此举可以解决在接收端丢包的问题，但是接受端的代码方面需要精简，一些无用的解析可以删除，这样也能防止丢包

v5:
在进行长时间的测试时，实现了20000次tPing写满一个文件，然后新建新的一个文件，但是依旧出现了0.01%的丢包问题。通过增大接收缓冲区，在21000次tPing中，没有出现丢包问题。测试126000次tPing未出现丢包问题。

v6:
频繁写入文件可能导致I/O阻塞，进而影响数据接收速度。使用缓冲批量写入，例如每收集一定数量的数据包再写入文件。由于发送端是每0.1秒发送100个数据包，因此在接收端，在接收100个数据包后，先存在内存中，然后一次写入文件。另外，双线程办法也能更好地接收数据，其中，主线程负责接收数据，子线程负责从buffer中读取并写入到硬盘中。
